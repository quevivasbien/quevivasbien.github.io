(()=>{"use strict";class t extends Array{constructor(...t){super(...t)}sum(){let t=0;for(let e=0;e<this.length;e++)t+=this[e];return t}prod(){let t=1;for(let e=0;e<this.length;e++)t*=this[e];return t}plus(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]+e[t]);return n}scalarPlus(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]+e);return n}sub(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]-e[t]);return n}times(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]*e[t]);return n}scalarTimes(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]*e);return n}div(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]/e[t]);return n}scalarDiv(e){let n=new t;for(let t=0;t<this.length;t++)n.push(this[t]/e);return n}pow(e){let n=new t;for(let t=0;t<this.length;t++)n.push(Math.pow(this[t],e[t]));return n}pretty(t=2){return`[${this.map((e=>e.toFixed(t))).join(", ")}]`}}function e(e){return new t(...e)}class n{constructor({a:e=new t(1,1),alpha:n=new t(1,1),b:r=new t(1,1),beta:s=new t(1,1),theta:o=new t(1,1)}={}){if(this.n=e.length,n.length!=this.n||r.length!=this.n||s.length!=this.n||o.length!=this.n)throw Error("Parameters to ProdFunc constructor must have equal length (=n)");this.a=e,this.alpha=n,this.b=r,this.beta=s,this.theta=o}f(t,e){const n=this.b.times(e.pow(this.beta));return[this.a.times(t.pow(this.alpha)).div(n.pow(this.theta)),n]}}function r(t){return t.div(t.scalarPlus(1)).prod()}class s{constructor({d:e=new t(0,0),r=new t(.01,.01),prodFunc:s=new n}={}){if(this.n=s.n,e.length!=this.n||r.length!=this.n)throw Error("Parameters to Problem constructor must have equal length (=n)");this.d=e,this.r=r,this.prodFunc=s}payoff(t,e,n){const[s,o]=this.prodFunc.f(e,n),i=r(s);return i*function(t,e){return e[t]/e.sum()}(t,o)-(1-i)*this.d[t]-this.r[t]*(e[t]+n[t])}payoffs(t,e){const[n,s]=this.prodFunc.f(t,e),o=r(n);return function(t){return t.scalarDiv(t.sum())}(s).plus(this.d).scalarTimes(o).sub(this.d).sub(this.r.times(t.plus(e)))}}class o{constructor(t,e,n,r){this.x=t,this.fx=e,this.iters=n,this.success=r}}function i(t,e){let n=new Array;for(let r=0;r<e.length;r++)n.push(t(e[r]));let r=Array.from(e.keys());r.sort(((t,e)=>n[t]-n[e]));let s=new Array,o=new Array;for(let t=0;t<e.length;t++)s.push(e[r[t]]),o.push(n[r[t]]);return[s,o]}function l(t,e){let n=new Array;for(let r=0;r<e;r++){let s=0;for(let n=0;n<e;n++)s+=t[n][r];n.push(s/e)}return n}function u(t,e){return function(t){const e=t.length;let n=0,r=0;for(let s=0;s<e;s++)n+=Math.pow(t[s],2),r+=t[s];return n/(e-1)-Math.pow(r,2)/(e*(e-1))}(t)<e}function h(t,e,n,r){let s=new Array;for(let o=0;o<n;o++)s.push(e[o]+r*(e[o]-t[n][o]));return s}function a(t,e,n,r){let s=new Array;for(let o=0;o<n;o++)s.push(t[o]+r*(e[o]-t[o]));return s}function c(t,e,n,r){let s=new Array;for(let o=0;o<n;o++)s.push(t[o]+r*(e[o]-t[o]));return s}function f(t,e,n){const r=t[0];for(let s=1;s<e+1;s++)for(let o=0;o<e;o++)t[s][o]=r[o]+n*(t[s][o]-r[o]);return t}function p(t,e,{maxIterations:n=100,tolerance:r=1e-6,initSimplexSize:s=1,alpha:p=1,gamma:d=2,rho:m=.5,sigma:g=.5}={}){const w=e.length;let y,x=function(t,e,n){let r=new Array;r.push(t);for(let s=0;s<e;s++){let e=[...t];e[s]+=n,r.push(e)}return r}(e,w,s);for(let e=0;e<n;e++){if([x,y]=i(t,x),u(y,r))return new o(x[0],y[0],e,!0);const n=l(x,w),s=h(x,n,w,p),M=t(s);if(M>=y[0]&&M<y[w-1]){x[w]=s;continue}if(M<y[0]){const e=a(n,s,w,d);t(e)<M?x[w]=e:x[w]=s;continue}let v;if(M<y[w]){if(v=c(n,s,w,m),t(v)<M){x[w]=v;continue}}else if(v=c(n,x[w],w,m),t(v)<y[w]){x[w]=v;continue}x=f(x,w,g)}return console.log("Warning, did not converge in specified number of iterations"),new o(x[0],t(x[0]),n,!1)}class d{constructor(t,e,n,s){this.success=e,this.xs=n,this.xp=s,[this.s,this.p]=t.prodFunc.f(n,s),this.total_safety=r(this.s),this.payoffs=t.payoffs(n,s)}}function m(){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e)}function g(e,n=0,r=1){const s=new t;for(let t=0;t<e;t++)s.push(Math.exp(n+r*m()));return s}function w(n,r,s,o,i,l){let u=new t,h=new t;for(let t=0;t<n.n;t++){let a=e(r),c=e(s);const f=p((e=>(a[t]=Math.exp(e[0]),c[t]=Math.exp(e[1]),-n.payoff(t,a,c))),[Math.log(r[t]),Math.log(s[t])],{tolerance:o,maxIterations:i,initSimplexSize:l});u.push(Math.exp(f.x[0])),h.push(Math.exp(f.x[1]))}return[u,h]}function y(t,e,n,r=1e-8){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(Math.abs((t[s]-e[s])/(e[s]+r))>n)return!1;return!0}function x(t,{tol:e=1e-6,maxIters:n=100,solverTol:r=1e-10,solverMaxIters:s=100,solverSimplexSize:o=100,retries:i=10}={}){let l=g(t.n),u=g(t.n);for(let i=0;i<n;i++){const[n,i]=w(t,l,u,r,s,o);if(y(n,l,e))return new d(t,!0,n,i);l=n,u=i}return i>0?(console.log("retrying..."),x(t,{tol:e,maxIters:n,solverTol:r,solverMaxIters:s,solverSimplexSize:o,retries:i-1})):(console.log("no retries remaining"),new d(t,!1,l,u))}const M={a:new t(0,0),alpha:new t(0,0),b:new t(0,0),beta:new t(0,0),theta:new t(0,0),d:new t(0,0),r:new t(0,0)};function v(t){const e=[document.getElementById(`${t}1`),document.getElementById(`${t}2`)],n=document.getElementById(`${t}-sync`);function r(){e[1].hidden=n.checked,e[1].value=e[0].value}n.checked=!0,r(),n.addEventListener("click",r);const s=document.getElementById(`${t}-display`);function o(r){n.checked&&(e[1-r].value=e[r].value),M[t][0]=parseFloat(e[0].value),M[t][1]=parseFloat(e[1].value),s.innerHTML=M[t].pretty()}o(0),e[0].addEventListener("input",(()=>o(0))),e[1].addEventListener("input",(()=>o(1)))}document.getElementById("button").addEventListener("click",(function(){const t=new n({a:M.a,alpha:M.alpha,b:M.b,beta:M.beta,theta:M.theta}),e=x(new s({prodFunc:t,d:M.d,r:M.r}));console.log("solver success: ",e.success),document.getElementById("solution-xs").innerHTML=e.xs.pretty(),document.getElementById("solution-xp").innerHTML=e.xp.pretty(),document.getElementById("solution-s").innerHTML=e.s.pretty(),document.getElementById("solution-p").innerHTML=e.p.pretty(),document.getElementById("solution-total-safety").innerHTML=`${(100*e.total_safety).toFixed(1)}%`,document.getElementById("solution-payoffs").innerHTML=e.payoffs.pretty()})),function(){for(let t in M)v(t)}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBaUNtQ1QsU0FBU0MsZUFBZSxVQUNwRE0saUJBQWlCLFNBMUJ4QixXQUNJLE1BQU0xRixFQUFXLElBQUloQixFQUFTLENBQzFCQyxFQUFHNEIsRUFBTzVCLEVBQ1ZDLE1BQU8yQixFQUFPM0IsTUFDZEMsRUFBRzBCLEVBQU8xQixFQUNWQyxLQUFNeUIsRUFBT3pCLEtBQ2JDLE1BQU93QixFQUFPeEIsUUFPWmtGLEVBQU1JLEVBTEksSUFBSTdFLEVBQVEsQ0FDeEJFLFNBQVVBLEVBQ1ZELEVBQUdjLEVBQU9kLEVBQ1ZFLEVBQUdZLEVBQU9aLEtBR2RnRCxRQUFRQyxJQUFJLG1CQUFvQnFCLEVBQUk3RCxTQUVwQ3lFLFNBQVNDLGVBQWUsZUFBZVcsVUFBWXhCLEVBQUk5RSxHQUFHakIsU0FDMUQyRyxTQUFTQyxlQUFlLGVBQWVXLFVBQVl4QixFQUFJN0UsR0FBR2xCLFNBQzFEMkcsU0FBU0MsZUFBZSxjQUFjVyxVQUFZeEIsRUFBSTFFLEVBQUVyQixTQUN4RDJHLFNBQVNDLGVBQWUsY0FBY1csVUFBWXhCLEVBQUk1RSxFQUFFbkIsU0FFeEQyRyxTQUFTQyxlQUFlLHlCQUF5QlcsVUFBWSxJQUF1QixJQUFuQnhCLEVBQUlsQixjQUFvQnpFLFFBQVEsTUFDakd1RyxTQUFTQyxlQUFlLG9CQUFvQlcsVUFBWXhCLEVBQUlsRSxRQUFRN0IsUUFDeEUsSUE3QkEsV0FDSSxJQUFLLElBQUl3SCxLQUFLbkYsRUFDVm1FLEVBQWNnQixFQUV0QixDQThCQUMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWluY2VudGl2ZXMtdHMvLi9zcmMvdmVjLnRzIiwid2VicGFjazovL2FpLWluY2VudGl2ZXMtdHMvLi9zcmMvcHJvYmxlbS50cyIsIndlYnBhY2s6Ly9haS1pbmNlbnRpdmVzLXRzLy4vc3JjL25lbGRlck1lYWQudHMiLCJ3ZWJwYWNrOi8vYWktaW5jZW50aXZlcy10cy8uL3NyYy9zb2x2ZS50cyIsIndlYnBhY2s6Ly9haS1pbmNlbnRpdmVzLXRzLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBWZWMgZXh0ZW5kcyBBcnJheTxudW1iZXI+IHtcblxuICAgIC8vIGNvbnN0cnVjdG9yKHg6IEFycmF5PG51bWJlcj4pIHtcbiAgICAvLyAgICAgdGhpcy54ID0geDtcbiAgICAvLyAgICAgdGhpcy5sZW5ndGggPSB4Lmxlbmd0aDtcbiAgICAvLyB9XG5cbiAgICAvLyBnZXQoaTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAvLyAgICAgcmV0dXJuIHRoaXNbaV07XG4gICAgLy8gfVxuXG4gICAgY29uc3RydWN0b3IoLi4uaXRlbXM6IEFycmF5PG51bWJlcj4pIHtcbiAgICAgICAgc3VwZXIoLi4uaXRlbXMpO1xuICAgIH1cblxuICAgIHN1bSgpOiBudW1iZXIge1xuICAgICAgICBsZXQgb3V0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQgKz0gdGhpc1tpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH1cblxuICAgIHByb2QoKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IG91dCA9IDE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb3V0ICo9IHRoaXNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBwbHVzKHk6IFZlYyk6IFZlYyB7XG4gICAgICAgIGxldCBvdXQgPSBuZXcgVmVjKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb3V0LnB1c2godGhpc1tpXSArIHlbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuXG4gICAgc2NhbGFyUGx1cyh5OiBudW1iZXIpOiBWZWMge1xuICAgICAgICBsZXQgb3V0ID0gbmV3IFZlYygpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIG91dC5wdXNoKHRoaXNbaV0gKyB5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH1cblxuICAgIHN1Yih5OiBWZWMpOiBWZWMge1xuICAgICAgICBsZXQgb3V0ID0gbmV3IFZlYygpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIG91dC5wdXNoKHRoaXNbaV0gLSB5W2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH1cblxuICAgIHRpbWVzKHk6IFZlYyk6IFZlYyB7XG4gICAgICAgIGxldCBvdXQgPSBuZXcgVmVjKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb3V0LnB1c2godGhpc1tpXSAqIHlbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuXG4gICAgc2NhbGFyVGltZXMoeTogbnVtYmVyKTogVmVjIHtcbiAgICAgICAgbGV0IG91dCA9IG5ldyBWZWMoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQucHVzaCh0aGlzW2ldICogeSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBkaXYoeTogVmVjKTogVmVjIHtcbiAgICAgICAgbGV0IG91dCA9IG5ldyBWZWMoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQucHVzaCh0aGlzW2ldIC8geVtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBzY2FsYXJEaXYoeTogbnVtYmVyKTogVmVjIHtcbiAgICAgICAgbGV0IG91dCA9IG5ldyBWZWMoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQucHVzaCh0aGlzW2ldIC8geSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBwb3coeTogVmVjKTogVmVjIHtcbiAgICAgICAgbGV0IG91dCA9IG5ldyBWZWMoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBvdXQucHVzaChNYXRoLnBvdyh0aGlzW2ldLCB5W2ldKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBwcmV0dHkobmRlY2ltYWw6IG51bWJlciA9IDIpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzdHJzID0gdGhpcy5tYXAoeCA9PiB4LnRvRml4ZWQobmRlY2ltYWwpKTtcbiAgICAgICAgcmV0dXJuIGBbJHtzdHJzLmpvaW4oXCIsIFwiKX1dYDtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2ZWModjogQXJyYXk8bnVtYmVyPik6IFZlYyB7XG4gICAgcmV0dXJuIG5ldyBWZWMoLi4udik7XG59XG4iLCJpbXBvcnQgeyBWZWMgfSBmcm9tIFwiLi92ZWNcIjtcblxuZXhwb3J0IGNsYXNzIFByb2RGdW5jIHtcbiAgICBuOiBudW1iZXI7XG4gICAgYTogVmVjO1xuICAgIGFscGhhOiBWZWM7XG4gICAgYjogVmVjO1xuICAgIGJldGE6IFZlYztcbiAgICB0aGV0YTogVmVjO1xuXG4gICAgY29uc3RydWN0b3Ioe1xuICAgICAgICBhID0gbmV3IFZlYygxLCAxKSxcbiAgICAgICAgYWxwaGEgPSBuZXcgVmVjKDEsIDEpLFxuICAgICAgICBiID0gbmV3IFZlYygxLCAxKSxcbiAgICAgICAgYmV0YSA9IG5ldyBWZWMoMSwgMSksXG4gICAgICAgIHRoZXRhID0gbmV3IFZlYygxLCAxKVxuICAgIH0gPSB7fSkge1xuICAgICAgICB0aGlzLm4gPSBhLmxlbmd0aDtcbiAgICAgICAgaWYgKGFscGhhLmxlbmd0aCAhPSB0aGlzLm4gfHwgYi5sZW5ndGggIT0gdGhpcy5uIHx8IGJldGEubGVuZ3RoICE9IHRoaXMubiB8fCB0aGV0YS5sZW5ndGggIT0gdGhpcy5uKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIlBhcmFtZXRlcnMgdG8gUHJvZEZ1bmMgY29uc3RydWN0b3IgbXVzdCBoYXZlIGVxdWFsIGxlbmd0aCAoPW4pXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYSA9IGE7XG4gICAgICAgIHRoaXMuYWxwaGEgPSBhbHBoYTtcbiAgICAgICAgdGhpcy5iID0gYjtcbiAgICAgICAgdGhpcy5iZXRhID0gYmV0YTtcbiAgICAgICAgdGhpcy50aGV0YSA9IHRoZXRhO1xuICAgIH1cblxuICAgIGYoeHM6IFZlYywgeHA6IFZlYyk6IFtWZWMsIFZlY10ge1xuICAgICAgICBjb25zdCBwID0gdGhpcy5iLnRpbWVzKHhwLnBvdyh0aGlzLmJldGEpKTtcbiAgICAgICAgY29uc3QgcyA9IHRoaXMuYS50aW1lcyh4cy5wb3codGhpcy5hbHBoYSkpLmRpdihwLnBvdyh0aGlzLnRoZXRhKSk7XG4gICAgICAgIHJldHVybiBbcywgcF07XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjc2YoaTogbnVtYmVyLCBwOiBWZWMpOiBudW1iZXIge1xuICAgIHJldHVybiBwW2ldIC8gcC5zdW0oKTtcbn1cblxuZnVuY3Rpb24gY3NmcyhwOiBWZWMpOiBWZWMge1xuICAgIHJldHVybiBwLnNjYWxhckRpdihwLnN1bSgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldF90b3RhbF9zYWZldHkoczogVmVjKTogbnVtYmVyIHtcbiAgICByZXR1cm4gcy5kaXYocy5zY2FsYXJQbHVzKDEpKS5wcm9kKCk7XG59XG5cbmV4cG9ydCBjbGFzcyBQcm9ibGVtIHtcbiAgICBuOiBudW1iZXI7XG4gICAgZDogVmVjO1xuICAgIHI6IFZlYztcbiAgICBwcm9kRnVuYzogUHJvZEZ1bmM7XG4gICAgXG4gICAgY29uc3RydWN0b3Ioe1xuICAgICAgICBkID0gbmV3IFZlYygwLCAwKSxcbiAgICAgICAgciA9IG5ldyBWZWMoMC4wMSwgMC4wMSksXG4gICAgICAgIHByb2RGdW5jID0gbmV3IFByb2RGdW5jKClcbiAgICB9ID0ge30pIHtcbiAgICAgICAgdGhpcy5uID0gcHJvZEZ1bmMublxuICAgICAgICBpZiAoZC5sZW5ndGggIT0gdGhpcy5uIHx8IHIubGVuZ3RoICE9IHRoaXMubikge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJQYXJhbWV0ZXJzIHRvIFByb2JsZW0gY29uc3RydWN0b3IgbXVzdCBoYXZlIGVxdWFsIGxlbmd0aCAoPW4pXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZCA9IGQ7XG4gICAgICAgIHRoaXMuciA9IHI7XG4gICAgICAgIHRoaXMucHJvZEZ1bmMgPSBwcm9kRnVuYztcbiAgICB9XG5cbiAgICBwYXlvZmYoaTogbnVtYmVyLCB4czogVmVjLCB4cDogVmVjKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgW3MsIHBdID0gdGhpcy5wcm9kRnVuYy5mKHhzLCB4cCk7XG4gICAgICAgIGNvbnN0IHNhZmV0eSA9IGdldF90b3RhbF9zYWZldHkocyk7XG4gICAgICAgIHJldHVybiBzYWZldHkgKiBjc2YoaSwgcCkgLSAoMSAtIHNhZmV0eSkgKiB0aGlzLmRbaV0gLSB0aGlzLnJbaV0gKiAoeHNbaV0gKyB4cFtpXSk7XG4gICAgfVxuXG4gICAgcGF5b2Zmcyh4czogVmVjLCB4cDogVmVjKTogVmVjIHtcbiAgICAgICAgY29uc3QgW3MsIHBdID0gdGhpcy5wcm9kRnVuYy5mKHhzLCB4cCk7XG4gICAgICAgIGNvbnN0IHNhZmV0eSA9IGdldF90b3RhbF9zYWZldHkocyk7XG4gICAgICAgIC8vIG91dCA9IChjc2YocCkgKyBkKSAqIHNhZmV0eSAtIGQgLSByICogKHhzICsgeHApXG4gICAgICAgIHJldHVybiBjc2ZzKHApLnBsdXModGhpcy5kKS5zY2FsYXJUaW1lcyhzYWZldHkpLnN1Yih0aGlzLmQpLnN1YihcbiAgICAgICAgICAgIHRoaXMuci50aW1lcyh4cy5wbHVzKHhwKSlcbiAgICAgICAgKTtcbiAgICB9XG59XG5cbi8vIGZ1bmN0aW9uIHRlc3QoKSB7XG4vLyAgICAgbGV0IHByb2RGdW5jID0gbmV3IFByb2RGdW5jKCk7XG4vLyAgICAgbGV0IHByb2JsZW0gPSBuZXcgUHJvYmxlbSh7IHByb2RGdW5jOiBwcm9kRnVuYyB9KTtcbi8vICAgICBjb25zdCB4cyA9IG5ldyBWZWMoMSwgMSk7XG4vLyAgICAgY29uc3QgeHAgPSBuZXcgVmVjKDEsIDIpO1xuLy8gICAgIGNvbnN0IHBheW9mZnMgPSBwcm9ibGVtLnBheW9mZnMoeHMsIHhwKTtcbi8vICAgICBjb25zb2xlLmxvZyhwYXlvZmZzKTtcbi8vIH0iLCJjbGFzcyBSZXN1bHQge1xuICAgIHg6IEFycmF5PG51bWJlcj47XG4gICAgZng6IG51bWJlcjtcbiAgICBpdGVyczogbnVtYmVyO1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHg6IEFycmF5PG51bWJlcj4sXG4gICAgICAgIGZ4OiBudW1iZXIsXG4gICAgICAgIGl0ZXJzOiBudW1iZXIsXG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICApIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy5meCA9IGZ4O1xuICAgICAgICB0aGlzLml0ZXJzID0gaXRlcnM7XG4gICAgICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7XG4gICAgfVxufVxuXG50eXBlIE9iamVjdGl2ZSA9ICh4OiBBcnJheTxudW1iZXI+KSA9PiBudW1iZXI7XG5cbmZ1bmN0aW9uIGNyZWF0ZVNpbXBsZXgoeDA6IEFycmF5PG51bWJlcj4sIG5EaW1zOiBudW1iZXIsIHNpemU6IG51bWJlcik6IEFycmF5PEFycmF5PG51bWJlcj4+IHtcbiAgICBsZXQgc2ltcGxleCA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xuICAgIHNpbXBsZXgucHVzaCh4MCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuRGltczsgaSsrKSB7XG4gICAgICAgIGxldCB4ID0gWy4uLngwXTtcbiAgICAgICAgeFtpXSArPSBzaXplO1xuICAgICAgICBzaW1wbGV4LnB1c2goeCk7XG4gICAgfVxuICAgIHJldHVybiBzaW1wbGV4O1xufVxuXG5mdW5jdGlvbiBzb3J0QW5kR2V0VmFscyhmOiBPYmplY3RpdmUsIHNpbXBsZXg6IEFycmF5PEFycmF5PG51bWJlcj4+KTogW0FycmF5PEFycmF5PG51bWJlcj4+LCBBcnJheTxudW1iZXI+XSB7XG4gICAgbGV0IHZhbHVlcyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaW1wbGV4Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhbHVlcy5wdXNoKGYoc2ltcGxleFtpXSkpO1xuICAgIH1cbiAgICBsZXQgaW5kaWNlcyA9IEFycmF5LmZyb20oc2ltcGxleC5rZXlzKCkpO1xuICAgIGluZGljZXMuc29ydCgoYSwgYikgPT4gdmFsdWVzW2FdIC0gdmFsdWVzW2JdKTtcbiAgICBsZXQgc29ydGVkU2ltcGxleCA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xuICAgIGxldCBzb3J0ZWRWYWx1ZXMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2ltcGxleC5sZW5ndGg7IGkrKykge1xuICAgICAgICBzb3J0ZWRTaW1wbGV4LnB1c2goc2ltcGxleFtpbmRpY2VzW2ldXSk7XG4gICAgICAgIHNvcnRlZFZhbHVlcy5wdXNoKHZhbHVlc1tpbmRpY2VzW2ldXSk7XG4gICAgfVxuICAgIHJldHVybiBbc29ydGVkU2ltcGxleCwgc29ydGVkVmFsdWVzXTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2VudHJvaWQoc2ltcGxleDogQXJyYXk8QXJyYXk8bnVtYmVyPj4sIG5EaW1zOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBsZXQgY2VudHJvaWQgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbkRpbXM7IGkrKykge1xuICAgICAgICBsZXQgc3VtID0gMDtcbiAgICAgICAgLy8gd2UgZXhjbHVkZSBpbmRleCBqID0gbkRpbXMsIGJlY2F1c2UgaXQgaXMgdGhlIHdvcnN0IHBvaW50XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbkRpbXM7IGorKykge1xuICAgICAgICAgICAgc3VtICs9IHNpbXBsZXhbal1baV07XG4gICAgICAgIH1cbiAgICAgICAgY2VudHJvaWQucHVzaChzdW0gLyBuRGltcyk7XG4gICAgfVxuICAgIHJldHVybiBjZW50cm9pZDtcbn1cblxuZnVuY3Rpb24gZGlzdGFuY2UoeDogQXJyYXk8bnVtYmVyPiwgeTogQXJyYXk8bnVtYmVyPik6IG51bWJlciB7XG4gICAgbGV0IHN1bSA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHN1bSArPSBNYXRoLnBvdyh4W2ldIC0geVtpXSwgMik7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLnNxcnQoc3VtKTtcbn1cblxuZnVuY3Rpb24gc3RkRGV2KHZhbHVlczogQXJyYXk8bnVtYmVyPik6IG51bWJlciB7XG4gICAgY29uc3QgbiA9IHZhbHVlcy5sZW5ndGg7XG4gICAgbGV0IHNxdWFyZWRTdW0gPSAwO1xuICAgIGxldCBzdW0gPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHNxdWFyZWRTdW0gKz0gTWF0aC5wb3codmFsdWVzW2ldLCAyKTtcbiAgICAgICAgc3VtICs9IHZhbHVlc1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHNxdWFyZWRTdW0gLyAobiAtIDEpIC0gTWF0aC5wb3coc3VtLCAyKSAvIChuICogKG4tMSkpO1xufVxuXG5mdW5jdGlvbiBleGl0KHZhbHVlczogQXJyYXk8bnVtYmVyPiwgdG9sOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3RkRGV2KHZhbHVlcykgPCB0b2w7XG59XG5cbmZ1bmN0aW9uIGdldFJlZmxlY3RlZChzaW1wbGV4OiBBcnJheTxBcnJheTxudW1iZXI+PiwgY2VudHJvaWQ6IEFycmF5PG51bWJlcj4sIG5EaW1zOiBudW1iZXIsIGFscGhhOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBsZXQgcmVmbGVjdGVkID0gbmV3IEFycmF5PG51bWJlcj4oKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5EaW1zOyBpKyspIHtcbiAgICAgICAgcmVmbGVjdGVkLnB1c2goY2VudHJvaWRbaV0gKyBhbHBoYSAqIChjZW50cm9pZFtpXSAtIHNpbXBsZXhbbkRpbXNdW2ldKSk7XG4gICAgfVxuICAgIHJldHVybiByZWZsZWN0ZWQ7XG59XG5cbmZ1bmN0aW9uIGdldEV4cGFuZGVkKGNlbnRyb2lkOiBBcnJheTxudW1iZXI+LCByZWZsZWN0ZWQ6IEFycmF5PG51bWJlcj4sIG5EaW1zOiBudW1iZXIsIGdhbW1hOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBsZXQgZXhwYW5kZWQgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbkRpbXM7IGkrKykge1xuICAgICAgICBleHBhbmRlZC5wdXNoKGNlbnRyb2lkW2ldICsgZ2FtbWEgKiAocmVmbGVjdGVkW2ldIC0gY2VudHJvaWRbaV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cGFuZGVkO1xufVxuXG5mdW5jdGlvbiBnZXRDb250cmFjdGVkKGNlbnRyb2lkOiBBcnJheTxudW1iZXI+LCBvdGhlcjogQXJyYXk8bnVtYmVyPiwgbkRpbXM6IG51bWJlciwgcmhvOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBsZXQgY29udHJhY3RlZCA9IG5ldyBBcnJheTxudW1iZXI+KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuRGltczsgaSsrKSB7XG4gICAgICAgIGNvbnRyYWN0ZWQucHVzaChjZW50cm9pZFtpXSArIHJobyAqIChvdGhlcltpXSAtIGNlbnRyb2lkW2ldKSk7XG4gICAgfVxuICAgIHJldHVybiBjb250cmFjdGVkO1xufVxuXG5mdW5jdGlvbiBzaHJpbmtUb3dhcmRCZXN0KHNpbXBsZXg6IEFycmF5PEFycmF5PG51bWJlcj4+LCBuRGltczogbnVtYmVyLCBzaWdtYTogbnVtYmVyKTogQXJyYXk8QXJyYXk8bnVtYmVyPj4ge1xuICAgIGNvbnN0IGJlc3QgPSBzaW1wbGV4WzBdO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbkRpbXMgKyAxOyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBuRGltczsgaisrKSB7XG4gICAgICAgICAgICBzaW1wbGV4W2ldW2pdID0gYmVzdFtqXSArIHNpZ21hICogKHNpbXBsZXhbaV1bal0gLSBiZXN0W2pdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc2ltcGxleDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pbmltaXplKFxuICAgIGY6IE9iamVjdGl2ZSwgeDA6IEFycmF5PG51bWJlcj4sXG4gICAge1xuICAgICAgICBtYXhJdGVyYXRpb25zID0gMTAwLFxuICAgICAgICB0b2xlcmFuY2UgPSAxZS02LFxuICAgICAgICBpbml0U2ltcGxleFNpemUgPSAxLFxuICAgICAgICBhbHBoYSA9IDEsXG4gICAgICAgIGdhbW1hID0gMixcbiAgICAgICAgcmhvID0gMC41LFxuICAgICAgICBzaWdtYSA9IDAuNVxuICAgIH0gPSB7fVxuKTogUmVzdWx0IHtcbiAgICBjb25zdCBuRGltcyA9IHgwLmxlbmd0aDtcbiAgICBsZXQgc2ltcGxleCA9IGNyZWF0ZVNpbXBsZXgoeDAsIG5EaW1zLCBpbml0U2ltcGxleFNpemUpO1xuICAgIGxldCB2YWx1ZXM6IEFycmF5PG51bWJlcj47XG4gICAgZm9yIChsZXQgaXRlciA9IDA7IGl0ZXIgPCBtYXhJdGVyYXRpb25zOyBpdGVyKyspIHtcbiAgICAgICAgLy8gKDEpIE9yZGVyIGFuZCBkZWNpZGUgd2hldGhlciB0byBxdWl0XG4gICAgICAgIFtzaW1wbGV4LCB2YWx1ZXNdID0gc29ydEFuZEdldFZhbHMoZiwgc2ltcGxleCk7XG4gICAgICAgIGlmIChleGl0KHZhbHVlcywgdG9sZXJhbmNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQoc2ltcGxleFswXSwgdmFsdWVzWzBdLCBpdGVyLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAoMikgR2V0IGNlbnRyb2lkXG4gICAgICAgIGNvbnN0IGNlbnRyb2lkID0gZ2V0Q2VudHJvaWQoc2ltcGxleCwgbkRpbXMpO1xuICAgICAgICAvLyAoMykgR2V0IHJlZmxlY3RlZCBwb2ludFxuICAgICAgICBjb25zdCByZWZsZWN0ZWQgPSBnZXRSZWZsZWN0ZWQoc2ltcGxleCwgY2VudHJvaWQsIG5EaW1zLCBhbHBoYSk7XG4gICAgICAgIGNvbnN0IGZfcmVmbGVjdGVkID0gZihyZWZsZWN0ZWQpO1xuICAgICAgICBpZiAoZl9yZWZsZWN0ZWQgPj0gdmFsdWVzWzBdICYmIGZfcmVmbGVjdGVkIDwgdmFsdWVzW25EaW1zIC0gMV0pIHtcbiAgICAgICAgICAgIHNpbXBsZXhbbkRpbXNdID0gcmVmbGVjdGVkO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gKDQpIElmIHJlZmxlY3RlZCBwb2ludCBpcyBiZXN0IHNvIGZhciwgZ2V0IGV4cGFuZGVkIHBvaW50ICYgY29udGludWVcbiAgICAgICAgaWYgKGZfcmVmbGVjdGVkIDwgdmFsdWVzWzBdKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZCA9IGdldEV4cGFuZGVkKGNlbnRyb2lkLCByZWZsZWN0ZWQsIG5EaW1zLCBnYW1tYSk7XG4gICAgICAgICAgICBpZiAoZihleHBhbmRlZCkgPCBmX3JlZmxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHNpbXBsZXhbbkRpbXNdID0gZXhwYW5kZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaW1wbGV4W25EaW1zXSA9IHJlZmxlY3RlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vICg1KSBJZiByZWZsZWN0ZWQgcG9pbnQgaXMgYXQgbGVhc3QgYXMgYmFkIGFzIHNlY29uZC13b3JzdCwgZ2V0IGNvbnRyYWN0ZWQgcG9pbnRcbiAgICAgICAgbGV0IGNvbnRyYWN0ZWQ6IEFycmF5PG51bWJlcj47XG4gICAgICAgIGlmIChmX3JlZmxlY3RlZCA8IHZhbHVlc1tuRGltc10pIHtcbiAgICAgICAgICAgIGNvbnRyYWN0ZWQgPSBnZXRDb250cmFjdGVkKGNlbnRyb2lkLCByZWZsZWN0ZWQsIG5EaW1zLCByaG8pO1xuICAgICAgICAgICAgaWYgKGYoY29udHJhY3RlZCkgPCBmX3JlZmxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHNpbXBsZXhbbkRpbXNdID0gY29udHJhY3RlZDtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRyYWN0ZWQgPSBnZXRDb250cmFjdGVkKGNlbnRyb2lkLCBzaW1wbGV4W25EaW1zXSwgbkRpbXMsIHJobyk7XG4gICAgICAgICAgICBpZiAoZihjb250cmFjdGVkKSA8IHZhbHVlc1tuRGltc10pIHtcbiAgICAgICAgICAgICAgICBzaW1wbGV4W25EaW1zXSA9IGNvbnRyYWN0ZWQ7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gKDYpIElmIGNvbnRyYWN0ZWQgcG9pbnQgaXMgd29yc3QsIHNocmluayB0aGUgc2ltcGxleFxuICAgICAgICBzaW1wbGV4ID0gc2hyaW5rVG93YXJkQmVzdChzaW1wbGV4LCBuRGltcywgc2lnbWEpO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIldhcm5pbmcsIGRpZCBub3QgY29udmVyZ2UgaW4gc3BlY2lmaWVkIG51bWJlciBvZiBpdGVyYXRpb25zXCIpO1xuICAgIHJldHVybiBuZXcgUmVzdWx0KHNpbXBsZXhbMF0sIGYoc2ltcGxleFswXSksIG1heEl0ZXJhdGlvbnMsIGZhbHNlKTtcbn1cbiIsImltcG9ydCB7IG1pbmltaXplIH0gZnJvbSBcIi4vbmVsZGVyTWVhZFwiXG5pbXBvcnQgeyBWZWMsIHZlYyB9IGZyb20gXCIuL3ZlY1wiXG5pbXBvcnQgeyBnZXRfdG90YWxfc2FmZXR5LCBQcm9ibGVtIH0gZnJvbSBcIi4vcHJvYmxlbVwiXG5cbmNsYXNzIFNvbHZlclJlc3VsdCB7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB4czogVmVjO1xuICAgIHhwOiBWZWM7XG4gICAgczogVmVjO1xuICAgIHA6IFZlYztcbiAgICB0b3RhbF9zYWZldHk6IG51bWJlcjtcbiAgICBwYXlvZmZzOiBWZWM7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9ibGVtOiBQcm9ibGVtLCBzdWNjZXNzOiBib29sZWFuLCB4czogVmVjLCB4cDogVmVjKSB7XG4gICAgICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7XG4gICAgICAgIHRoaXMueHMgPSB4cztcbiAgICAgICAgdGhpcy54cCA9IHhwO1xuICAgICAgICBbdGhpcy5zLCB0aGlzLnBdID0gcHJvYmxlbS5wcm9kRnVuYy5mKHhzLCB4cCk7XG4gICAgICAgIHRoaXMudG90YWxfc2FmZXR5ID0gZ2V0X3RvdGFsX3NhZmV0eSh0aGlzLnMpO1xuICAgICAgICB0aGlzLnBheW9mZnMgPSBwcm9ibGVtLnBheW9mZnMoeHMsIHhwKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJhbmRuKCk6IG51bWJlciB7XG4gICAgbGV0IHUgPSAwLCB2ID0gMDtcbiAgICB3aGlsZSAodSA9PT0gMCkge1xuICAgICAgICB1ID0gTWF0aC5yYW5kb20oKTtcbiAgICB9XG4gICAgd2hpbGUgKHYgPT09IDApIHtcbiAgICAgICAgdiA9IE1hdGgucmFuZG9tKCk7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLnNxcnQoLTIuMCAqIE1hdGgubG9nKHUpKSAqIE1hdGguY29zKDIuMCAqIE1hdGguUEkgKiB2KTtcbn1cblxuZnVuY3Rpb24gc2FtcGxlTG9nTm9ybWFsKG46IG51bWJlciwgbXU6IG51bWJlciA9IDAsIHNpZ21hOiBudW1iZXIgPSAxKTogVmVjIHtcbiAgICBjb25zdCBvdXQgPSBuZXcgVmVjKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgb3V0LnB1c2goTWF0aC5leHAobXUgKyBzaWdtYSAqIHJhbmRuKCkpKTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn1cblxuZnVuY3Rpb24gc29sdmVJdGVyKFxuICAgIHByb2JsZW06IFByb2JsZW0sXG4gICAgaW5pdFhzOiBWZWMsXG4gICAgaW5pdFhwOiBWZWMsXG4gICAgc29sdmVyVG9sOiBudW1iZXIsXG4gICAgc29sdmVyTWF4SXRlcnM6IG51bWJlcixcbiAgICBzb2x2ZXJTaW1wbGV4U2l6ZTogbnVtYmVyXG4pOiBbVmVjLCBWZWNdIHtcbiAgICBsZXQgWHMgPSBuZXcgVmVjKCk7XG4gICAgbGV0IFhwID0gbmV3IFZlYygpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvYmxlbS5uOyBpKyspIHtcbiAgICAgICAgbGV0IHhzID0gdmVjKGluaXRYcyk7XG4gICAgICAgIGxldCB4cCA9IHZlYyhpbml0WHApO1xuICAgICAgICBjb25zdCBvYmplY3RpdmUgPSAoeDogQXJyYXk8bnVtYmVyPikgPT4ge1xuICAgICAgICAgICAgeHNbaV0gPSBNYXRoLmV4cCh4WzBdKTtcbiAgICAgICAgICAgIHhwW2ldID0gTWF0aC5leHAoeFsxXSk7XG4gICAgICAgICAgICByZXR1cm4gLXByb2JsZW0ucGF5b2ZmKGksIHhzLCB4cCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzID0gbWluaW1pemUoXG4gICAgICAgICAgICBvYmplY3RpdmUsIFtNYXRoLmxvZyhpbml0WHNbaV0pLCBNYXRoLmxvZyhpbml0WHBbaV0pXSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0b2xlcmFuY2U6IHNvbHZlclRvbCxcbiAgICAgICAgICAgICAgICBtYXhJdGVyYXRpb25zOiBzb2x2ZXJNYXhJdGVycyxcbiAgICAgICAgICAgICAgICBpbml0U2ltcGxleFNpemU6IHNvbHZlclNpbXBsZXhTaXplXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIFhzLnB1c2goTWF0aC5leHAocmVzLnhbMF0pKTtcbiAgICAgICAgWHAucHVzaChNYXRoLmV4cChyZXMueFsxXSkpO1xuICAgIH1cbiAgICByZXR1cm4gW1hzLCBYcF07XG59XG5cbmZ1bmN0aW9uIGFwcHJveEVxdWFsKHg6IFZlYywgeTogVmVjLCB0b2w6IG51bWJlciwgZXBzOiBudW1iZXIgPSAxZS04KTogYm9vbGVhbiB7XG4gICAgaWYgKHgubGVuZ3RoICE9PSB5Lmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoTWF0aC5hYnMoKHhbaV0gLSB5W2ldKSAvICh5W2ldICsgZXBzKSkgPiB0b2wpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvbHZlKFxuICAgIHByb2JsZW06IFByb2JsZW0sXG4gICAge1xuICAgICAgICB0b2wgPSAxZS02LFxuICAgICAgICBtYXhJdGVycyA9IDEwMCxcbiAgICAgICAgc29sdmVyVG9sID0gMWUtMTAsXG4gICAgICAgIHNvbHZlck1heEl0ZXJzID0gMTAwLFxuICAgICAgICBzb2x2ZXJTaW1wbGV4U2l6ZSA9IDEwMCxcbiAgICAgICAgcmV0cmllcyA9IDEwXG4gICAgfSA9IHt9XG4pOiBTb2x2ZXJSZXN1bHQge1xuICAgIGxldCBYcyA9IHNhbXBsZUxvZ05vcm1hbChwcm9ibGVtLm4pO1xuICAgIGxldCBYcCA9IHNhbXBsZUxvZ05vcm1hbChwcm9ibGVtLm4pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4SXRlcnM7IGkrKykge1xuICAgICAgICBjb25zdCBbbmV3WHMsIG5ld1hwXSA9IHNvbHZlSXRlcihcbiAgICAgICAgICAgIHByb2JsZW0sIFhzLCBYcCxcbiAgICAgICAgICAgIHNvbHZlclRvbCwgc29sdmVyTWF4SXRlcnMsIHNvbHZlclNpbXBsZXhTaXplXG4gICAgICAgICk7XG4gICAgICAgIGlmIChhcHByb3hFcXVhbChuZXdYcywgWHMsIHRvbCkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgU29sdmVyUmVzdWx0KHByb2JsZW0sIHRydWUsIG5ld1hzLCBuZXdYcCk7XG4gICAgICAgIH1cbiAgICAgICAgWHMgPSBuZXdYcztcbiAgICAgICAgWHAgPSBuZXdYcDtcbiAgICB9XG4gICAgaWYgKHJldHJpZXMgPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmV0cnlpbmcuLi5cIik7XG4gICAgICAgIHJldHVybiBzb2x2ZShcbiAgICAgICAgICAgIHByb2JsZW0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdG9sOiB0b2wsXG4gICAgICAgICAgICAgICAgbWF4SXRlcnM6IG1heEl0ZXJzLFxuICAgICAgICAgICAgICAgIHNvbHZlclRvbDogc29sdmVyVG9sLFxuICAgICAgICAgICAgICAgIHNvbHZlck1heEl0ZXJzOiBzb2x2ZXJNYXhJdGVycyxcbiAgICAgICAgICAgICAgICBzb2x2ZXJTaW1wbGV4U2l6ZTogc29sdmVyU2ltcGxleFNpemUsXG4gICAgICAgICAgICAgICAgcmV0cmllczogcmV0cmllcyAtIDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIm5vIHJldHJpZXMgcmVtYWluaW5nXCIpXG4gICAgcmV0dXJuIG5ldyBTb2x2ZXJSZXN1bHQocHJvYmxlbSwgZmFsc2UsIFhzLCBYcCk7XG59XG4iLCJpbXBvcnQgeyB2ZWMsIFZlYyB9IGZyb20gJy4vdmVjJztcbmltcG9ydCB7IFByb2RGdW5jLCBQcm9ibGVtIH0gZnJvbSAnLi9wcm9ibGVtJztcbmltcG9ydCB7IHNvbHZlIH0gZnJvbSAnLi9zb2x2ZSc7XG5cbmludGVyZmFjZSBWYWx1ZU1hcCB7XG4gICAgW2tleTogc3RyaW5nXTogVmVjO1xufVxuXG5jb25zdCB2YWx1ZXM6IFZhbHVlTWFwID0ge1xuICAgIGE6IG5ldyBWZWMoMCwgMCksXG4gICAgYWxwaGE6IG5ldyBWZWMoMCwgMCksXG4gICAgYjogbmV3IFZlYygwLCAwKSxcbiAgICBiZXRhOiBuZXcgVmVjKDAsIDApLFxuICAgIHRoZXRhOiBuZXcgVmVjKDAsIDApLFxuICAgIGQ6IG5ldyBWZWMoMCwgMCksXG4gICAgcjogbmV3IFZlYygwLCAwKVxufTtcblxuZnVuY3Rpb24gc2V0dXBDb250cm9scyh2YXJOYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzbGlkZXJzID0gW1xuICAgICAgICA8SFRNTElucHV0RWxlbWVudD4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dmFyTmFtZX0xYCkpLFxuICAgICAgICA8SFRNTElucHV0RWxlbWVudD4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dmFyTmFtZX0yYCkpXG4gICAgXTtcbiAgICBjb25zdCBzeW5jQm94ID0gPEhUTUxJbnB1dEVsZW1lbnQ+KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3Zhck5hbWV9LXN5bmNgKSk7XG4gICAgZnVuY3Rpb24gc2V0U3luYygpIHtcbiAgICAgICAgc2xpZGVyc1sxXS5oaWRkZW4gPSBzeW5jQm94LmNoZWNrZWQ7XG4gICAgICAgIHNsaWRlcnNbMV0udmFsdWUgPSBzbGlkZXJzWzBdLnZhbHVlO1xuICAgIH1cbiAgICBzeW5jQm94LmNoZWNrZWQgPSB0cnVlO1xuICAgIHNldFN5bmMoKTtcbiAgICBzeW5jQm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzZXRTeW5jKTtcbiAgICBjb25zdCBkaXNwbGF5ID0gPEhUTUxTcGFuRWxlbWVudD4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dmFyTmFtZX0tZGlzcGxheWApKTtcbiAgICBmdW5jdGlvbiB1cGRhdGUoY2hhbmdlZDogbnVtYmVyKSB7XG4gICAgICAgIGlmIChzeW5jQm94LmNoZWNrZWQpIHtcbiAgICAgICAgICAgIHNsaWRlcnNbMS1jaGFuZ2VkXS52YWx1ZSA9IHNsaWRlcnNbY2hhbmdlZF0udmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFsdWVzW3Zhck5hbWVdWzBdID0gcGFyc2VGbG9hdChzbGlkZXJzWzBdLnZhbHVlKTtcbiAgICAgICAgdmFsdWVzW3Zhck5hbWVdWzFdID0gcGFyc2VGbG9hdChzbGlkZXJzWzFdLnZhbHVlKTtcbiAgICAgICAgZGlzcGxheS5pbm5lckhUTUwgPSB2YWx1ZXNbdmFyTmFtZV0ucHJldHR5KCk7XG4gICAgfVxuICAgIHVwZGF0ZSgwKTtcbiAgICBzbGlkZXJzWzBdLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB1cGRhdGUoMCkpO1xuICAgIHNsaWRlcnNbMV0uYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHVwZGF0ZSgxKSk7XG59XG5cbmZ1bmN0aW9uIHNldHVwQWxsQ29udHJvbHMoKSB7XG4gICAgZm9yIChsZXQgayBpbiB2YWx1ZXMpIHtcbiAgICAgICAgc2V0dXBDb250cm9scyhrKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJ1bigpIHtcbiAgICBjb25zdCBwcm9kRnVuYyA9IG5ldyBQcm9kRnVuYyh7XG4gICAgICAgIGE6IHZhbHVlcy5hLFxuICAgICAgICBhbHBoYTogdmFsdWVzLmFscGhhLFxuICAgICAgICBiOiB2YWx1ZXMuYixcbiAgICAgICAgYmV0YTogdmFsdWVzLmJldGEsXG4gICAgICAgIHRoZXRhOiB2YWx1ZXMudGhldGFcbiAgICB9KTtcbiAgICBjb25zdCBwcm9ibGVtID0gbmV3IFByb2JsZW0oe1xuICAgICAgICBwcm9kRnVuYzogcHJvZEZ1bmMsXG4gICAgICAgIGQ6IHZhbHVlcy5kLFxuICAgICAgICByOiB2YWx1ZXMuclxuICAgIH0pO1xuICAgIGNvbnN0IHJlcyA9IHNvbHZlKHByb2JsZW0pO1xuICAgIGNvbnNvbGUubG9nKFwic29sdmVyIHN1Y2Nlc3M6IFwiLCByZXMuc3VjY2VzcylcblxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic29sdXRpb24teHNcIikuaW5uZXJIVE1MID0gcmVzLnhzLnByZXR0eSgpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic29sdXRpb24teHBcIikuaW5uZXJIVE1MID0gcmVzLnhwLnByZXR0eSgpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic29sdXRpb24tc1wiKS5pbm5lckhUTUwgPSByZXMucy5wcmV0dHkoKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvbHV0aW9uLXBcIikuaW5uZXJIVE1MID0gcmVzLnAucHJldHR5KCk7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvbHV0aW9uLXRvdGFsLXNhZmV0eVwiKS5pbm5lckhUTUwgPSBgJHsocmVzLnRvdGFsX3NhZmV0eSAqIDEwMCkudG9GaXhlZCgxKX0lYDtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvbHV0aW9uLXBheW9mZnNcIikuaW5uZXJIVE1MID0gcmVzLnBheW9mZnMucHJldHR5KCk7XG59XG5cbmNvbnN0IGJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidXR0b25cIikpO1xuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBydW4pO1xuXG5zZXR1cEFsbENvbnRyb2xzKCk7Il0sIm5hbWVzIjpbIlZlYyIsIkFycmF5IiwiY29uc3RydWN0b3IiLCJpdGVtcyIsInN1cGVyIiwic3VtIiwib3V0IiwiaSIsInRoaXMiLCJsZW5ndGgiLCJwcm9kIiwicGx1cyIsInkiLCJwdXNoIiwic2NhbGFyUGx1cyIsInN1YiIsInRpbWVzIiwic2NhbGFyVGltZXMiLCJkaXYiLCJzY2FsYXJEaXYiLCJwb3ciLCJNYXRoIiwicHJldHR5IiwibmRlY2ltYWwiLCJtYXAiLCJ4IiwidG9GaXhlZCIsImpvaW4iLCJ2ZWMiLCJ2IiwiUHJvZEZ1bmMiLCJhIiwiYWxwaGEiLCJiIiwiYmV0YSIsInRoZXRhIiwibiIsIkVycm9yIiwiZiIsInhzIiwieHAiLCJwIiwiZ2V0X3RvdGFsX3NhZmV0eSIsInMiLCJQcm9ibGVtIiwiZCIsInByb2RGdW5jIiwiciIsInBheW9mZiIsInNhZmV0eSIsImNzZiIsInBheW9mZnMiLCJjc2ZzIiwiUmVzdWx0IiwiZngiLCJpdGVycyIsInN1Y2Nlc3MiLCJzb3J0QW5kR2V0VmFscyIsInNpbXBsZXgiLCJ2YWx1ZXMiLCJpbmRpY2VzIiwiZnJvbSIsImtleXMiLCJzb3J0Iiwic29ydGVkU2ltcGxleCIsInNvcnRlZFZhbHVlcyIsImdldENlbnRyb2lkIiwibkRpbXMiLCJjZW50cm9pZCIsImoiLCJleGl0IiwidG9sIiwic3F1YXJlZFN1bSIsInN0ZERldiIsImdldFJlZmxlY3RlZCIsInJlZmxlY3RlZCIsImdldEV4cGFuZGVkIiwiZ2FtbWEiLCJleHBhbmRlZCIsImdldENvbnRyYWN0ZWQiLCJvdGhlciIsInJobyIsImNvbnRyYWN0ZWQiLCJzaHJpbmtUb3dhcmRCZXN0Iiwic2lnbWEiLCJiZXN0IiwibWluaW1pemUiLCJ4MCIsIm1heEl0ZXJhdGlvbnMiLCJ0b2xlcmFuY2UiLCJpbml0U2ltcGxleFNpemUiLCJzaXplIiwiY3JlYXRlU2ltcGxleCIsIml0ZXIiLCJmX3JlZmxlY3RlZCIsImNvbnNvbGUiLCJsb2ciLCJTb2x2ZXJSZXN1bHQiLCJwcm9ibGVtIiwidG90YWxfc2FmZXR5IiwicmFuZG4iLCJ1IiwicmFuZG9tIiwic3FydCIsImNvcyIsIlBJIiwic2FtcGxlTG9nTm9ybWFsIiwibXUiLCJleHAiLCJzb2x2ZUl0ZXIiLCJpbml0WHMiLCJpbml0WHAiLCJzb2x2ZXJUb2wiLCJzb2x2ZXJNYXhJdGVycyIsInNvbHZlclNpbXBsZXhTaXplIiwiWHMiLCJYcCIsInJlcyIsImFwcHJveEVxdWFsIiwiZXBzIiwiYWJzIiwic29sdmUiLCJtYXhJdGVycyIsInJldHJpZXMiLCJuZXdYcyIsIm5ld1hwIiwic2V0dXBDb250cm9scyIsInZhck5hbWUiLCJzbGlkZXJzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN5bmNCb3giLCJzZXRTeW5jIiwiaGlkZGVuIiwiY2hlY2tlZCIsInZhbHVlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRpc3BsYXkiLCJ1cGRhdGUiLCJjaGFuZ2VkIiwicGFyc2VGbG9hdCIsImlubmVySFRNTCIsImsiLCJzZXR1cEFsbENvbnRyb2xzIl0sInNvdXJjZVJvb3QiOiIifQ==